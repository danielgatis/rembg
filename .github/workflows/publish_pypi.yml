name: Publish to Pypi

on:
    push:
        tags:
            - "v*.*.*"

jobs:
    publish_pypi:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
              with:
                  fetch-depth: 0
            - uses: actions/setup-python@v5
            - name: Install Poetry
              uses: snok/install-poetry@v1
              with:
                  virtualenvs-create: true
                  virtualenvs-in-project: true
            - name: Install dependencies
              run: |
                  poetry self add "poetry-dynamic-versioning[plugin]"
                  poetry install --with dev --extras "cpu cli"
            - name: Build and publish to PyPI
              run: |
                  poetry build
                  poetry publish
              env:
                  POETRY_PYPI_TOKEN_PYPI: ${{ secrets.PIPY_PASSWORD }}
